<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../css/mui.css">
    <title>店铺导航</title>
</head>
<body>
<div style="height: 100vh;width: 100%;background: url(../img/tiaozhuan22.png) no-repeat;background-size: 100% 100%;"></div>
<h4 style="width: 100%;font-size:18px;text-align: center; position: fixed;top: 0;background-color: #fff;margin: 0;padding: 20px;color:#333333;">定位中，请等待......</h4>
<script src="../js/jquery/jquery.min.js"></script>
<script src="../js/mui.js"></script>
<script src="https://webapi.amap.com/maps?v=1.4.0&key=abf2b393ef072ecab1e7322d97ffc258&plugin=AMap.Driving"></script>
<script>
    var geolocation;
    var map = new AMap.Map('allmap', {
        resizeEnable: true
    });
    var lang = GetQueryString('lang');
    var lat = GetQueryString('lat');
    getMessage();
    function getMessage() {
        map.plugin('AMap.Geolocation', function() {
            geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,
                timeout: 10000,
                buttonOffset: new AMap.Pixel(10, 20),
                zoomToAccuracy: false,
                buttonPosition:'RB'
            });
            map.addControl(geolocation);
            geolocation.getCurrentPosition();
            AMap.event.addListener(geolocation, 'complete', onComplete);
            AMap.event.addListener(geolocation, 'error', onError);
        });
    }
    function onComplete(data) {
        window.location.href = "http://m.amap.com/navigation/carmap/saddr="+ data.position.getLng() +","+ data.position.getLat() +"&daddr="+ lang +","+ lat +"";
    }
    function onError(data) {
        $('h4').html('定位失败');
        mui.alert('获取位置信息失败，请开启定位重试');
    }
    function GetQueryString(url) {
        var reg = new RegExp("(^|&)" + url + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r != null) {
            return unescape(r[2]);
        }
        return null;
    }
</script>
</body>
</html>